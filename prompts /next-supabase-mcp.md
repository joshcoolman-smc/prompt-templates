# Supabase Setup Guide

This guide covers setting up a Next.js TypeScript + Tailwind project with Supabase using the MCP server for AI-driven database development.

## Prerequisites

- Next.js project with TypeScript and Tailwind CSS
- Node.js installed
- Supabase account

## 1. MCP Server Configuration

Create `.mcp.json` in your project root:

```json
{
  "mcpServers": {
    "supabase": {
      "command": "npx",
      "args": [
        "-y",
        "@supabase/mcp-server-supabase@latest"
      ],
      "env": {
        "SUPABASE_ACCESS_TOKEN": "your-access-token-here"
      }
    }
  }
}
```

### Getting Your Access Token

1. Go to [Supabase Dashboard](https://supabase.com/dashboard)
2. Settings → Access Tokens
3. Generate new token with organization-level permissions
4. Name it "Claude Code MCP" or similar
5. Copy the token and replace `your-access-token-here` in `.mcp.json`

## 2. Install Supabase Client

```bash
npm install @supabase/supabase-js
```

## 3. Environment Variables

Create `.env.local`:

```env
NEXT_PUBLIC_SUPABASE_URL=your-supabase-url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
```

*Note: These will be populated after creating your Supabase project via AI*

## 4. Supabase Client Setup

Create `lib/supabase.ts`:

```typescript
import { createClient } from '@supabase/supabase-js'

const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!
const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!

export const supabase = createClient(supabaseUrl, supabaseAnonKey)
```

## 5. TypeScript Types Setup

Create `types/database.ts`:

```typescript
// This file will be generated by AI using the MCP server
// After creating tables, AI will run generate_typescript_types
export interface Database {
  // Generated types will go here
}

// Helper types for easier use
export type User = Database['public']['Tables']['users']['Row']
export type NewUser = Database['public']['Tables']['users']['Insert']
// Add more helper types as needed
```

## 6. Development User System

For frictionless prototyping, create `lib/dev-auth.ts`:

```typescript
// Development-only user switching
export const DEV_USERS = [
  { id: 'user-1', email: 'alice@test.com', name: 'Alice Admin', role: 'admin' },
  { id: 'user-2', email: 'bob@test.com', name: 'Bob User', role: 'user' },
  { id: 'user-3', email: 'carol@test.com', name: 'Carol Manager', role: 'manager' }
] as const

export const getCurrentUserId = () => {
  // In dev, return from localStorage or state
  return localStorage.getItem('dev-user-id') || 'user-1'
}

export const setCurrentUserId = (userId: string) => {
  localStorage.setItem('dev-user-id', userId)
}
```

## 7. Project Structure

```
├── .mcp.json                 # MCP server configuration
├── .env.local               # Environment variables
├── lib/
│   ├── supabase.ts         # Supabase client
│   └── dev-auth.ts         # Development user system
├── types/
│   └── database.ts         # Generated database types
└── components/
    └── DevUserSwitcher.tsx # Development user switcher
```

## 8. AI Workflow Commands

Once setup is complete, you can use these AI commands:

### Create New Project
```
"Create a new Supabase project called 'my-app-prototype'"
```

### Create Tables
```
"Create a users table with id, email, name, role, and created_at"
"Create a posts table that references users with title, content, and timestamps"
```

### Generate Types
```
"Generate TypeScript types for this project and update the database.ts file"
```

### Seed Development Data
```
"Seed the database with the dev users and some sample posts"
```

## 9. Development User Switcher Component

Create `components/DevUserSwitcher.tsx`:

```typescript
'use client'

import { useState, useEffect } from 'react'
import { DEV_USERS, getCurrentUserId, setCurrentUserId } from '@/lib/dev-auth'

export default function DevUserSwitcher() {
  const [currentUserId, setCurrentUserIdState] = useState<string>('')

  useEffect(() => {
    setCurrentUserIdState(getCurrentUserId())
  }, [])

  const handleUserChange = (userId: string) => {
    setCurrentUserId(userId)
    setCurrentUserIdState(userId)
    window.location.reload() // Refresh to apply new user context
  }

  if (process.env.NODE_ENV === 'production') return null

  return (
    <div className="fixed top-4 right-4 bg-yellow-100 p-2 rounded border">
      <label className="text-sm font-medium">Dev User:</label>
      <select 
        value={currentUserId} 
        onChange={(e) => handleUserChange(e.target.value)}
        className="ml-2 text-sm border rounded px-2 py-1"
      >
        {DEV_USERS.map(user => (
          <option key={user.id} value={user.id}>
            {user.name} ({user.role})
          </option>
        ))}
      </select>
    </div>
  )
}
```

## 10. Getting Started

1. Complete the setup above
2. Add your Supabase access token to `.mcp.json`
3. Restart Claude Code to load the MCP server
4. Start building with AI:
   - "Let's create a new Supabase project for this app"
   - "Create tables for users, posts, and comments"
   - "Generate TypeScript types"
   - "Create a user dashboard component"

## Benefits of This Setup

- **Zero abstraction**: Direct SQL with TypeScript types
- **AI-native**: LLM can create/modify database schema naturally
- **Frictionless prototyping**: No login required during development
- **Type safety**: Generated types from actual database schema
- **Realistic testing**: Multi-user scenarios without auth complexity
- **Production ready**: Easy transition to real auth when ready

## Security Notes

- The MCP server has full database permissions for development
- Use only with development/staging environments
- Never expose access tokens in client-side code
- Review all AI-generated SQL before applying to production
